---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);

const pageSize = 9;
const currentPage = 1;
const totalPages = Math.ceil(sortedPosts.length / pageSize);
const paginatedPosts = sortedPosts.slice(0, pageSize);
---

<Layout
    title="Blog | Mi Sitio Web"
    description="Lee las últimas noticias y artículos de nuestro blog."
>
    <section class="py-12">
        <div class="container mx-auto px-4">
            <h1
                class="text-4xl font-bold text-center mb-8 text-gray-900 dark:text-white"
            >
                Nuestro Blog
            </h1>

            {
                paginatedPosts.length === 0 ? (
                    <div class="text-center">
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            No se encontraron posts.
                        </p>
                    </div>
                ) : (
                    <>
                        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
                            {paginatedPosts.map((post) => (
                                <article class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 flex flex-col h-full">
                                    <a
                                        href={`/blog/${post.slug}/`}
                                        class="block flex-grow"
                                    >
                                        <div class="relative">
                                            <img
                                                src={
                                                    post.data.image ||
                                                    "/blog-placeholder-default.jpg"
                                                }
                                                alt={`Imagen para ${post.data.title}`}
                                                class="w-full h-48 object-cover"
                                            />
                                            <span class="absolute top-2 right-2 bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded">
                                                {post.data.category}
                                            </span>
                                        </div>
                                        <div class="p-6">
                                            <h2 class="text-2xl font-bold mb-2 text-gray-900 dark:text-white">
                                                {post.data.title}
                                            </h2>
                                            <p class="text-gray-700 dark:text-gray-300 mb-4 line-clamp-3">
                                                {post.data.description}
                                            </p>
                                            <div class="flex items-center justify-between mt-auto">
                                                <time
                                                    datetime={post.data.date.toISOString()}
                                                    class="text-sm text-gray-500 dark:text-gray-400"
                                                >
                                                    {new Date(
                                                        post.data.date,
                                                    ).toLocaleDateString(
                                                        "es-ES",
                                                        {
                                                            year: "numeric",
                                                            month: "long",
                                                            day: "numeric",
                                                        },
                                                    )}
                                                </time>
                                                <span class="text-sm text-gray-500 dark:text-gray-400">
                                                    Por {post.data.author}
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                </article>
                            ))}
                        </div>

                        {totalPages > 1 && (
                            <nav
                                class="mt-12 flex justify-center items-center gap-2"
                                aria-label="Paginación del blog"
                            >
                                <span class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-400 dark:text-gray-600 bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg cursor-not-allowed">
                                    <svg
                                        class="w-5 h-5 mr-2"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M15 19l-7-7 7-7"
                                        />
                                    </svg>
                                    Anterior
                                </span>

                                <div class="hidden sm:flex gap-1">
                                    {Array.from(
                                        { length: totalPages },
                                        (_, i) => i + 1,
                                    ).map((num) =>
                                        num === 1 ? (
                                            <span class="inline-flex items-center justify-center w-10 h-10 text-sm font-semibold text-white bg-blue-600 rounded-lg">
                                                {num}
                                            </span>
                                        ) : (
                                            <a
                                                href={`/blog/${num}`}
                                                class="inline-flex items-center justify-center w-10 h-10 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                                            >
                                                {num}
                                            </a>
                                        ),
                                    )}
                                </div>

                                <span class="sm:hidden px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                                    Página 1 de {totalPages}
                                </span>

                                {totalPages > 1 ? (
                                    <a
                                        href="/blog/2"
                                        class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                                    >
                                        Siguiente
                                        <svg
                                            class="w-5 h-5 ml-2"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M9 5l7 7-7 7"
                                            />
                                        </svg>
                                    </a>
                                ) : (
                                    <span class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-400 dark:text-gray-600 bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg cursor-not-allowed">
                                        Siguiente
                                        <svg
                                            class="w-5 h-5 ml-2"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M9 5l7 7-7 7"
                                            />
                                        </svg>
                                    </span>
                                )}
                            </nav>
                        )}
                    </>
                )
            }
        </div>
    </section>
</Layout>
