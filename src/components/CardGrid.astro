---
// src/components/CardGrid.astro - Componente de Cards Responsivo y Reutilizable
interface CardItem {
  id?: string;
  title: string;
  description?: string;
  image?: string;
  date?: string;
  author?: string;
  category?: string;
  tags?: string[];
  price?: number;
  currency?: string;
  rating?: number;
  featured?: boolean;
  url?: string;
  buttonText?: string;
  buttonVariant?: 'primary' | 'secondary' | 'outline';
  metadata?: Record<string, any>;
}

interface Props {
  items: CardItem[];
  columns?: 2 | 3 | 4;
  variant?: 'blog' | 'product' | 'testimonial' | 'project' | 'generic';
  showImages?: boolean;
  showDate?: boolean;
  showAuthor?: boolean;
  showCategory?: boolean;
  showTags?: boolean;
  showPrice?: boolean;
  showRating?: boolean;
  showButton?: boolean;
  buttonText?: string;
  imageAspect?: 'square' | 'video' | 'portrait' | 'landscape';
  gap?: 'small' | 'medium' | 'large';
  class?: string;
}

const {
  items,
  columns = 3,
  variant = 'generic',
  showImages = true,
  showDate = false,
  showAuthor = false,
  showCategory = false,
  showTags = false,
  showPrice = false,
  showRating = false,
  showButton = false,
  buttonText = 'Ver m√°s',
  imageAspect = 'landscape',
  gap = 'medium',
  class: className = ''
} = Astro.props;

// Configuraci√≥n de columnas responsive
const gridClasses = {
  2: 'grid-cols-1 md:grid-cols-2',
  3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',
  4: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4'
};

// Configuraci√≥n de aspecto de imagen
const aspectClasses = {
  square: 'aspect-square',
  video: 'aspect-video',
  portrait: 'aspect-[3/4]',
  landscape: 'aspect-[4/3]'
};

// Configuraci√≥n de gap
const gapClasses = {
  small: 'gap-4',
  medium: 'gap-6',
  large: 'gap-8'
};

// Funci√≥n para renderizar estrellas de rating
function renderStars(rating: number): string {
  const fullStars = Math.floor(rating);
  const hasHalfStar = rating % 1 !== 0;
  const emptyStars = 5 - Math.ceil(rating);

  let stars = '';

  // Estrellas llenas
  for (let i = 0; i < fullStars; i++) {
    stars += '<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
  }

  // Media estrella
  if (hasHalfStar) {
    stars += '<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20"><defs><linearGradient id="halfStar"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="transparent"/></linearGradient></defs><path fill="url(#halfStar)" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
  }

  // Estrellas vac√≠as
  for (let i = 0; i < emptyStars; i++) {
    stars += '<svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
  }

  return stars;
}
---

<div class={`card-grid grid ${gridClasses[columns]} ${gapClasses[gap]} ${className}`}>
  {items.map((item) => (
    <article class={`card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 ${item.featured ? 'ring-2 ring-blue-500' : ''}`}>
      <!-- Imagen -->
      {showImages && item.image && (
        <div class={`relative overflow-hidden ${aspectClasses[imageAspect]}`}>
          <img
            src={item.image}
            alt={item.title}
            class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
            loading="lazy"
          />
          {item.featured && (
            <div class="absolute top-2 right-2 bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium">
              Destacado
            </div>
          )}
        </div>
      )}

      <!-- Contenido -->
      <div class="p-6">
        <!-- Categor√≠a -->
        {showCategory && item.category && (
          <span class="inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-medium px-2 py-1 rounded mb-2">
            {item.category}
          </span>
        )}

        <!-- T√≠tulo -->
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 line-clamp-2">
          {item.url ? (
            <a href={item.url} class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
              {item.title}
            </a>
          ) : (
            item.title
          )}
        </h3>

        <!-- Descripci√≥n -->
        {item.description && (
          <p class="text-gray-600 dark:text-gray-300 text-sm mb-4 line-clamp-3">
            {item.description}
          </p>
        )}

        <!-- Rating -->
        {showRating && item.rating && (
          <div class="flex items-center mb-3">
            <div class="flex items-center mr-2" set:html={renderStars(item.rating)}></div>
            <span class="text-sm text-gray-600 dark:text-gray-400">
              {item.rating}/5
            </span>
          </div>
        )}

        <!-- Precio -->
        {showPrice && item.price !== undefined && (
          <div class="mb-3">
            <span class="text-2xl font-bold text-green-600 dark:text-green-400">
              {item.currency || '‚Ç¨'}{item.price}
            </span>
          </div>
        )}

        <!-- Tags -->
        {showTags && item.tags && item.tags.length > 0 && (
          <div class="flex flex-wrap gap-1 mb-3">
            {item.tags.slice(0, 3).map((tag) => (
              <span class="inline-block bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-xs px-2 py-1 rounded">
                {tag}
              </span>
            ))}
            {item.tags.length > 3 && (
              <span class="text-xs text-gray-500 dark:text-gray-400">
                +{item.tags.length - 3} m√°s
              </span>
            )}
          </div>
        )}

        <!-- Metadata (fecha y autor) -->
        <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-4">
          <div class="flex items-center space-x-2">
            {showDate && item.date && (
              <span>üìÖ {new Date(item.date).toLocaleDateString()}</span>
            )}
            {showAuthor && item.author && (
              <span>üë§ {item.author}</span>
            )}
          </div>
        </div>

        <!-- Bot√≥n -->
        {showButton && (item.url || item.buttonText) && (
          <a
            href={item.url || '#'}
            class={`inline-block px-4 py-2 rounded-lg font-medium transition-colors ${
              item.buttonVariant === 'secondary'
                ? 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600'
                : item.buttonVariant === 'outline'
                ? 'border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white'
                : 'bg-blue-600 text-white hover:bg-blue-700'
            }`}
          >
            {item.buttonText || buttonText}
          </a>
        )}
      </div>
    </article>
  ))}
</div>

<style>
  .card-grid {
    @apply w-full;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Animaciones hover */
  .card:hover {
    @apply shadow-2xl;
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .card-grid {
      @apply gap-4;
    }

    .card div:first-child {
      @apply p-4;
    }
  }
</style>
