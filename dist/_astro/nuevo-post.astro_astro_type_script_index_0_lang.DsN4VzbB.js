const l=document.getElementById("content");function d(e,t="",n=""){const a=l.selectionStart,c=l.selectionEnd,o=l.value.substring(a,c),r=e+(o||n)+t,s=l.value;l.value=s.substring(0,a)+r+s.substring(c);const v=a+e.length+(o?o.length:0);l.focus(),l.setSelectionRange(v,v+(o?0:n.length))}document.querySelectorAll("[data-action]").forEach(e=>{e.addEventListener("click",t=>{switch(t.currentTarget.dataset.action){case"bold":d("**","**","negrita");break;case"italic":d("*","*","cursiva");break;case"h2":d(`
## `,"","Título");break;case"h3":d(`
### `,"","Subtítulo");break;case"link":const a=prompt("URL del enlace:","https://");a&&d("[",`](${a})`,"texto del enlace");break;case"image":const c=prompt("URL de la imagen:","https://");if(c){const i=prompt("Texto alternativo:","Descripción");d(`
![${i}](${c})
`,"")}break;case"youtube":const o=prompt("ID del video de YouTube:","");o&&d(`
<YouTube id="${o}" />
`,"");break;case"list":d(`
- `,"","Item");break;case"code":d("\n```javascript\n","\n```\n","código");break;case"quote":d(`
> `,"","Cita");break}})});l.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&(e.key==="b"?(e.preventDefault(),d("**","**","negrita")):e.key==="i"&&(e.preventDefault(),d("*","*","cursiva")))});function b(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function y(){let e=!0;const t=document.getElementById("date"),n=document.getElementById("date-error");if(!t.value)n.textContent="Fecha requerida",n.classList.remove("hidden"),e=!1;else{const i=new Date(t.value);isNaN(i.getTime())?(n.textContent="Fecha inválida",n.classList.remove("hidden"),e=!1):n.classList.add("hidden")}const a=document.getElementById("image"),c=document.getElementById("image-error");a.value&&!L(a.value)?(c.classList.remove("hidden"),e=!1):c.classList.add("hidden");const o=document.getElementById("title");return o.value.trim()||(o.focus(),e=!1),e}function L(e){try{return new URL(e),!0}catch{return!1}}function I(){const e=document.getElementById("title"),t=document.getElementById("slug"),n=document.getElementById("slug-value"),a=t.value.trim(),c=b(e.value),o=a||c;n.textContent=o||"-"}function f(){const e=document.getElementById("title").value,t=document.getElementById("description").value,n=document.getElementById("date").value,a=document.getElementById("author").value,c=document.getElementById("image").value,o=document.getElementById("category").value,i=document.getElementById("slug").value.trim(),r=document.getElementById("tags").value,s=document.getElementById("published").checked,v=document.getElementById("content").value,h=r.split(",").map(g=>g.trim()).filter(g=>g.length>0);let u=`---
title: "${e}"
description: "${t}"
date: "${n}"
author: "${a}"`;return c&&(u+=`
image: "${c}"`),u+=`
category: "${o}"`,i&&(u+=`
slug: "${i}"`),h.length>0&&(u+=`
tags: [${h.map(g=>`"${g}"`).join(", ")}]`),u+=`
published: ${s}
---

${v}
`,u}function m(e){const t=document.getElementById("notification"),n=document.getElementById("notification-text");n.textContent=e,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),2500)}const B=document.getElementById("description"),x=document.getElementById("char-count");B.addEventListener("input",()=>x.textContent=B.value.length.toString());const E=document.getElementById("date");E.valueAsDate=new Date;const w=document.getElementById("title"),k=document.getElementById("slug");w.addEventListener("input",I);k.addEventListener("input",I);I();E.addEventListener("change",()=>{const e=new Date(E.value),t=document.getElementById("date-error");isNaN(e.getTime())?(t.textContent="Fecha inválida",t.classList.remove("hidden")):t.classList.add("hidden")});const p=document.getElementById("image");p.addEventListener("input",()=>{const e=document.getElementById("image-error");p.value&&!L(p.value)?e.classList.remove("hidden"):e.classList.add("hidden")});document.getElementById("preview-btn").addEventListener("click",()=>{if(!y()){m("Por favor corrige los errores antes de ver la preview");return}const e=f(),t=document.querySelector("#preview-content code");t.textContent=e,document.getElementById("preview-modal").classList.remove("hidden")});document.getElementById("close-preview").addEventListener("click",()=>{document.getElementById("preview-modal").classList.add("hidden")});document.getElementById("copy-btn").addEventListener("click",async()=>{if(!y()){m("Por favor corrige los errores antes de copiar");return}const e=f();try{await navigator.clipboard.writeText(e),m("¡Copiado!")}catch{m("Error al copiar")}});document.getElementById("post-form").addEventListener("submit",e=>{if(e.preventDefault(),!y()){m("Por favor corrige los errores antes de descargar");return}const t=document.getElementById("title").value,n=f(),o=`${document.getElementById("slug").value.trim()||b(t)}.mdx`,i=new Blob([n],{type:"text/markdown"}),r=URL.createObjectURL(i),s=document.createElement("a");s.href=r,s.download=o,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),m(`¡Descargado: ${o}!`)});
